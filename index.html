<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="apple-touch-fullscreen" content="YES" />
<meta name="format-detection" content="telephone=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta http-equiv="Expires" content="-1" />
<meta http-equiv="pragram" content="no-cache" />
<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" type="text/css" rel="stylesheet"/>
<link href="css/style.css" type="text/css" rel="stylesheet"/>

<title>星云扭蛋机</title>
<!--移动端版本兼容 -->
<script type="text/javascript">
    var phoneWidth =  parseInt(window.screen.width);
    var phoneScale = phoneWidth/640;
    var ua = navigator.userAgent;
    if (/Android (\d+\.\d+)/.test(ua)){
        var version = parseFloat(RegExp.$1);
        // andriod 2.3
        if(version>2.3){
            document.write('<meta name="viewport" content="width=640, minimum-scale = '+phoneScale+', maximum-scale = '+phoneScale+', target-densitydpi=device-dpi">');
        // andriod 2.3以上
        }else{
            document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">');
        }
        // 其他系统
    } else {
        document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">');
    }
    //微信去掉下方刷新栏
    if(RegExp("MicroMessenger").test(navigator.userAgent)){
        document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
            WeixinJSBridge.call('hideToolbar');
        });
    }
</script>
    <script src="https://cdn.bootcss.com/jquery/1.8.3/jquery.min.js"></script>

</head>
<body>
<div class="container">
		<div class="header clearfix">
				<nav>
				  <ul class="nav nav-pills pull-right" id="myTab">
					<li role="presentation" class="active"><a href="#home" id="home" data-toggle="tab">Home</a></li>
					<li role="presentation"><a href="#mine" id="mine" data-toggle="tab">My</a></li>
					<li role="presentation"><a href="#contact" data-toggle="tab">Contact</a></li>
				  </ul>
				</nav>
				<h3 class="text-muted">星云扭蛋机</h3>
		</div>

<div class="bs-docs-header" id="content" tabindex="-1">
		<div class="container">
		  <h1>星云扭蛋机</h1>
		  <p>点击GO按钮可以获得全网限量发行的球星卡哦,凑齐球星可以组成一套梦幻球队哦</p>  
		</div>
</div>
<div class="tab-content">   
<div role="tabpanel" class="tab-pane" id="mineTab">
		<div class="pitch">
				<div  id="player0" class="field-player" style="top:10%;left:30%">
				  <img src="https://cdn.sofifa.org/sm/18/players/20801.png"></img>
				<div>C罗<span id="num0">x3</span></div></div>
				  <div id="player1" class="field-player" style="top:40%;left:28%">    <img src="https://cdn.sofifa.org/sm/18/players/165153.png"></img>
				<div >本泽马<span id="num1">x3</span></div></div>
					<div id="player2"class="field-player" style="top:70%;left:30%"> <img src="https://cdn.sofifa.org/sm/18/players/173731.png"></img>
				<div>贝尔<span id="num2">x3</span></div></div>
				  <div id="player3" class="field-player" style="top:25%;left:45%"><img src="https://cdn.sofifa.org/sm/18/players/182521.png"></img>
				<div>克罗斯<span id="num3">x3</span></div></div>
				  <div id="player4" class="field-player" style="top:40%;left:50%"><img src="https://cdn.sofifa.org/sm/18/players/200145.png"></img>
				<div>卡塞米罗<span id="num4">x3</span></div></div>
					<div id="player5" class="field-player" style="top:55%;left:45%"><img src="https://cdn.sofifa.org/sm/18/players/177003.png"></img>
				<div>莫德里奇<span id="num5">x3</span></div></div>
					<div  id="player6" class="field-player" style="top:10%;left:60%"><img src="https://cdn.sofifa.org/sm/18/players/176676.png"></img>
				<div>马塞洛<span id="num6">x3</span></div></div>
				  <div id="player7" class="field-player" style="top:30%;left:62%"><img src="https://cdn.sofifa.org/sm/18/players/155862.png"></img>
				<div>拉莫斯<span id="num7">x3</span></div></div>
					<div  id="player8" class="field-player" style="top:50%;left:62%"><img src="https://cdn.sofifa.org/sm/18/players/201535.png"></img>
				<div>瓦拉内<span id="num8">x3</span></div></div>
					  <div  id="player9" class="field-player" style="top:70%;left:60%"><img src="https://cdn.sofifa.org/sm/18/players/204963.png"></img>
				<div>卡瓦哈尔<span id="num9">x3</span></div></div>
						<div class="field-player" style="top:70%;left:60%"></div>
						  <div class="field-player" style="top:42%;left:70%"></div>
			  </div>
			</div>
<div role="tabpanel" class="tab-pane active" id="homeTab" >
<div class="niu_danji">
	<!--机器-->
	<div class="game_qu">
    	<!--go-->
        <div class="game_go">0.01NAS/次</div>
         <div class="wdjifen"></div>
    </div>
    
    <!--球-->
    <div class="dan_gund">
        <span  class="qiu_1 diaol_1"></span>
        <span  class="qiu_2 diaol_2"> </span>
        <span  class="qiu_3 diaol_3"></span>
        
        <span  class="qiu_4 diaol_4"></span>
        <span  class="qiu_5 diaol_5"></span>
        <span  class="qiu_6 diaol_6"></span>>
        
        <span  class="qiu_7 diaol_7"></span>
        <span  class="qiu_8 diaol_8"></span>
        
        
        <span  class="qiu_9 diaol_9"></span>
        <span  class="qiu_10 diaol_10"></span> 
        <span  class="qiu_11 diaol_11"></span>   
               
    </div>

     <!--中奖掉落-->
   <div class="medon"><img src="images/mendong.png"></div>
   <div class="zjdl ">
   		<span></span>
   </div>

   </div>




<!--中奖 获得一等奖-->
<div class="zonj_zezc none" id="jianpin_one">
	<div class="jpzs aiqiyi tc_anima">
    	<em><img src="images/close.png"></em>
        <h2>
        	<b>恭喜你！<br>获得一等奖！</b>
        </h2>
	</div>
</div>
</div>
</div>

<footer class="footer">
	<p>© 2018 wasabi studio, Inc.</p>
  </footer>
  </div>
<script src="lib/nebPay.min.js"></script>
<script>
  var NebPay = require("nebpay");
  var nebPay = new NebPay();	
$(document).ready(function(e) {
	var dappAddress = 'n1ktHzcs9BQbHXqhx6w5G3KKtc9niWiTQFx';
	var value = '0';
	var callFunction = 'getMine';
	var callArgs = JSON.stringify([""]);
	var cards = [0,0,0,0,0,0,0,0,0,0]
	nebPay.simulateCall(dappAddress, value, callFunction, callArgs, {    //使用nebpay的call接口去调用合约,
                listener: function(resp){
					var result = resp.result;
                    var resultObj = JSON.parse(result);
					for(var i=0;i<resultObj.length;i++){
						var val = resultObj[i];
						var idx = parseInt(val.drawNo,10);
						cards[idx] = cards[idx] +1 ;
					}
					for(var i=0;i<cards.length;i++){
						var cardNum = cards[i];
						if(cardNum == 0){
							$('#player'+i).hide();
						}else if(cardNum> 0){
							$('#player'+i).show();
							$('#num'+i).html('x'+cardNum); 
						}
					}
				}
        });
	$('#myTab a').click(function (e) {
            e.preventDefault();
			var id = $(this)[0].id;
			$('#mineTab').hide();
			$('#homeTab').hide();
			$('#'+id+'Tab').show();

			// remove all active
			$('#myTab').children().removeClass('active');
			$(this).parent().addClass('active')
        });

	//一等奖 关闭
	$("#jianpin_one em img").click(function(){
		$("#jianpin_one").hide();
		}
	);				


$(".game_go").click(function(){
	draw()
});
	
	
function draw(){
	for(i=1;i<=11;i++){
			$(".qiu_"+i).removeClass("diaol_"+i);
			$(".qiu_"+i).addClass("wieyi_"+i);
		};
			
	setTimeout(function (){
		for(i=1;i<=11;i++){
		$(".qiu_"+i).removeClass("wieyi_"+i);
		}
	},1100);	
	setTimeout(function(){
		$(".zjdl").children("span").addClass("diaL_one");

		$(".zjdl").removeClass("none").addClass("dila_Y");
				setTimeout(function (){
					$("#jianpin_one").show();
				},900);
		},1100)
	
	//取消动画
	setTimeout(function (){
			$(".zjdl").addClass("none").removeClass("dila_Y");
		//	$(".wdjifen").html(score);
			$(".zjdl").children("span").removeAttr('class');
			
		},2500)
			
}	
});

</script>
</body>
</html>